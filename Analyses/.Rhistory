fit.hab <- lm.rrpp(shape~svl*habitat, data = rdf)
coef.hab <- fit.hab$LM$coefficients
slp.hab <- rbind(coef.hab[2,], coef.hab[2,]+coef.hab[5,],
coef.hab[2,]+coef.hab[6,])
rownames(slp.hab) <- c("ground","rock", "tree")
slp.hab
slp.hab <-rbind(coef.evol, sp.hab)
slp.hab <-rbind(coef.evol, slp.hab)
slp.hab
slp.hab.angles <- acos(RRPP:::vec.cor.matrix(slp.hab)[,1])*180/pi
mean(slp.hab.angles)
hist(slp.hab.angles)
slp.hab.angles
libs <- c('geomorph', 'RRPP', 'phytools', 'geiger', 'tidyverse')
easypackages::libraries(libs)
# 0: Data Prep
data0 <- read.table('data/morpho/morpho_pristurus.csv', sep = ';', dec = '.', header = TRUE, stringsAsFactors = TRUE)
sp.to.keep <- names(which(table(data0$species) >= 5))
data <- data0[data0$species %in% sp.to.keep, ]
data$species <- droplevels(data$species)
data$SVL <- log(data$SVL)
shape <- as.matrix(log(data[, 8:ncol(data)]))
rdf <- rrpp.data.frame(svl = data$SVL, shape = shape, habitat = data$habitat_broad, species = data$species)
tree0 <- read.nexus('data/phylogeny/pristurus_tree_final.nex')
LS.mns <- pairwise(lm.rrpp(shape~species, data = rdf, iter=0), groups = rdf$species)$LS.means[[1]]
sz.mn <- tapply(rdf$svl,rdf$species,mean)
hab.mn <- as.factor(by(rdf$habitat,rdf$species,unique))
levels(hab.mn) <- levels(rdf$habitat)
tree <- treedata(phy = tree0, data = LS.mns)$phy
C <- vcv.phylo(tree)
# 1: Evolutionary Allometry
allom.sp <- lm.rrpp(LS.mns~sz.mn, Cov = C)
allom.ind <- lm.rrpp(shape~svl, data = rdf)
anova(allom.sp)
anova(allom.ind)
M <-rbind(coef.sp <- allom.sp$LM$gls.coefficients[2,],
coef.ind <- allom.ind$LM$coefficients[2,])
acos(RRPP:::vec.cor.matrix(M))*180/pi  #virtually parallel (angle of 1.49 degrees)
# 2: Comparison of multivariate allometry among habitat types
fit.hab <- lm.rrpp(shape~svl*habitat, data = rdf)
anova(fit.hab)
pw.hab <- pairwise(fit.hab, groups = rdf$habitat, covariate = rdf$svl)
summary(pw.hab, type = 'VC', stat.table = FALSE)
slp.hab
anova(fit.hab)
pw.hab <- pairwise(fit.hab, groups = rdf$habitat, covariate = rdf$svl)
summary(pw.hab, type = 'VC', stat.table = FALSE)
#Slopes by habitat
coef.hab <- fit.hab$LM$coefficients
slp.hab <- rbind(coef.hab[2,], coef.hab[2,]+coef.hab[5,], coef.hab[2,]+coef.hab[6,])
rownames(slp.hab) <- c("Ground","Rock", "Tree")
slp.hab
acos(RRPP:::vec.cor.matrix(slp.hab)[,1])*180/pi
coef.evol
libs <- c('geomorph', 'RRPP', 'phytools', 'geiger', 'tidyverse')
easypackages::libraries(libs)
# 0: Data Prep
data0 <- read.table('data/morpho/morpho_pristurus.csv', sep = ';', dec = '.', header = TRUE, stringsAsFactors = TRUE)
sp.to.keep <- names(which(table(data0$species) >= 5))
data <- data0[data0$species %in% sp.to.keep, ]
data$species <- droplevels(data$species)
data$SVL <- log(data$SVL)
shape <- as.matrix(log(data[, 8:ncol(data)]))
rdf <- rrpp.data.frame(svl = data$SVL, shape = shape, habitat = data$habitat_broad, species = data$species)
tree0 <- read.nexus('data/phylogeny/pristurus_tree_final.nex')
LS.mns <- pairwise(lm.rrpp(shape~species, data = rdf, iter=0), groups = rdf$species)$LS.means[[1]]
sz.mn <- tapply(rdf$svl,rdf$species,mean)
hab.mn <- as.factor(by(rdf$habitat,rdf$species,unique))
levels(hab.mn) <- levels(rdf$habitat)
tree <- treedata(phy = tree0, data = LS.mns)$phy
C <- vcv.phylo(tree)
# 1: Evolutionary Allometry
allom.sp <- lm.rrpp(LS.mns~sz.mn, Cov = C)
allom.ind <- lm.rrpp(shape~svl, data = rdf)
anova(allom.sp)
anova(allom.ind)
M <-rbind(coef.sp <- allom.sp$LM$gls.coefficients[2,],
coef.ind <- allom.ind$LM$coefficients[2,])
coef.evol
M <-rbind(coef.evol <- allom.sp$LM$gls.coefficients[2,],
coef.ind <- allom.ind$LM$coefficients[2,])
coef.evol
#Slopes by habitat
coef.hab <- fit.hab$LM$coefficients
slp.hab <- rbind(coef.hab[2,], coef.hab[2,]+coef.hab[5,], coef.hab[2,]+coef.hab[6,])
rownames(slp.hab) <- c("Ground","Rock", "Tree")
slp.hab
#Add evol. allometry vector
slp.hab <-rbind(coef.evol, slp.hab)
slp.hab
coef.evol
rbind(coef.evol, slp.hab)
libs <- c('geomorph', 'RRPP', 'phytools', 'geiger', 'tidyverse')
easypackages::libraries(libs)
# 0: Data Prep
data0 <- read.table('data/morpho/morpho_pristurus.csv', sep = ';', dec = '.', header = TRUE, stringsAsFactors = TRUE)
sp.to.keep <- names(which(table(data0$species) >= 5))
data <- data0[data0$species %in% sp.to.keep, ]
data$species <- droplevels(data$species)
data$SVL <- log(data$SVL)
shape <- as.matrix(log(data[, 8:ncol(data)]))
rdf <- rrpp.data.frame(svl = data$SVL, shape = shape, habitat = data$habitat_broad, species = data$species)
tree0 <- read.nexus('data/phylogeny/pristurus_tree_final.nex')
LS.mns <- pairwise(lm.rrpp(shape~species, data = rdf, iter=0), groups = rdf$species)$LS.means[[1]]
sz.mn <- tapply(rdf$svl,rdf$species,mean)
hab.mn <- as.factor(by(rdf$habitat,rdf$species,unique))
levels(hab.mn) <- levels(rdf$habitat)
tree <- treedata(phy = tree0, data = LS.mns)$phy
C <- vcv.phylo(tree)
# 1: Evolutionary Allometry
allom.sp <- lm.rrpp(LS.mns~sz.mn, Cov = C)
allom.ind <- lm.rrpp(shape~svl, data = rdf)
anova(allom.sp)
anova(allom.ind)
M <-rbind(coef.evol <- allom.sp$LM$gls.coefficients[2,],
coef.ind <- allom.ind$LM$coefficients[2,])
acos(RRPP:::vec.cor.matrix(M))*180/pi  #virtually parallel (angle of 1.49 degrees)
# 2: Comparison of multivariate allometry among habitat types
fit.hab <- lm.rrpp(shape~svl*habitat, data = rdf)
anova(fit.hab)
pw.hab <- pairwise(fit.hab, groups = rdf$habitat, covariate = rdf$svl)
summary(pw.hab, type = 'VC', stat.table = FALSE)
#Slopes by habitat
coef.hab <- fit.hab$LM$coefficients
slp.hab <- rbind(coef.hab[2,], coef.hab[2,]+coef.hab[5,], coef.hab[2,]+coef.hab[6,])
rownames(slp.hab) <- c("Ground","Rock", "Tree")
slp.hab
#Add evol. allometry vector
slp.hab <-rbind(coef.evol, slp.hab)
slp.hab.angles <- acos(RRPP:::vec.cor.matrix(slp.hab)[,1])*180/pi
slp.hab.angles
summary(pw.hab, type = 'VC', stat.table = FALSE)
slopes <- RRPP:::getSlopes(fit = fit.hab, x = rdf$svl, g = rdf$habitat)
slopes
slopes[[1]]
slp.hab
#Compare Evolutionary and individual (habitat-based) allometry
slopes <- lapply(1:1000, function(j) rbind(coef.evol,slopes[[j]]))
acos(RRPP:::vec.cor.matrix(slopes[[1]])[,1])*180/pi
slp.ang <- lapply(1:1000, function(j) acos(RRPP:::vec.cor.matrix(slopes[[j]])[,1])*180/pi)
slp.ang <- lapply(1:1000, function(j) acos(RRPP:::vec.cor.matrix(slopes[[j]]))*180/pi)
slp.ang[[1]]
summary(pw.hab, type = 'VC', stat.table = FALSE)
slp.hab.angles
slp.ang[[1]]
slp.Z <- RRPP:::effect.list(slp.ang)
slp.P <- RRPP:::Pval.list(slp.ang)
slp.P
slp.Z
RRPP:::Pval.list
RRPP:::pval
slp.ang[[1]]
slp.ang[[2]]
slp.ang[[3]]
slp.ang[[4]]
slp.ang[[5]]
?lm.rrpp
pw.hab$slopes
pw.hab$slopes[[1]]
slp.hab
#Compare Evolutionary and individual (habitat-based) allometry
slopes <- lapply(1:1000, function(j) rbind(coef.evol,pw.hab$slopes[[j]]))
#slopes <- lapply(1:1000, function(j) rbind(coef.evol,slopes[[j]]))
slp.ang <- lapply(1:1000, function(j) acos(RRPP:::vec.cor.matrix(slopes[[j]]))*180/pi)
slp.hab.obs <- slp.ang[[1]]
slp.Z <- RRPP:::effect.list(slp.ang)
slp.P <- RRPP:::Pval.list(slp.ang)
slp.hab.obs
slp.Z
slp.P
fit.0 <- lm.rrpp(shape~1, data = rdf)
pw.hab <- pairwise(fit.hab, fit.null = fit.0,,groups = rdf$habitat, covariate = rdf$svl)
summary(pw.hab, type = 'VC', stat.table = FALSE)
#Slopes by habitat
slp.hab <- pw.hab$slopes[[1]]
slp.hab
#Compare Evolutionary and individual (habitat-based) allometry
slopes <- lapply(1:1000, function(j) rbind(coef.evol,pw.hab$slopes[[j]]))
#slopes <- lapply(1:1000, function(j) rbind(coef.evol,slopes[[j]]))
slp.ang <- lapply(1:1000, function(j) acos(RRPP:::vec.cor.matrix(slopes[[j]]))*180/pi)
slp.hab.obs <- slp.ang[[1]]
slp.Z <- RRPP:::effect.list(slp.ang)
slp.P <- RRPP:::Pval.list(slp.ang)
slp.hab.obs
slp.Z
slp.P
fit.0 <- lm.rrpp(shape~habitat, data = rdf) #null: group differences only (no allometry)
pw.hab <- pairwise(fit.hab, fit.null = fit.0, groups = rdf$habitat, covariate = rdf$svl)
slp.hab <- pw.hab$slopes[[1]]
#Slopes by habitat
slopes <- lapply(1:1000, function(j) rbind(coef.evol,pw.hab$slopes[[j]]))
slp.ang <- lapply(1:1000, function(j) acos(RRPP:::vec.cor.matrix(slopes[[j]]))*180/pi)
slp.hab.obs <- slp.ang[[1]]
slp.Z <- RRPP:::effect.list(slp.ang)
slp.P <- RRPP:::Pval.list(slp.ang)
slp.hab.obs
slp.Z
slp.P  #significantly smaller than expected (basically, they are the same)
libs <- c('geomorph', 'RRPP', 'phytools', 'geiger', 'tidyverse')
easypackages::libraries(libs)
# 0: Data Prep
data0 <- read.table('data/morpho/morpho_pristurus.csv', sep = ';', dec = '.', header = TRUE, stringsAsFactors = TRUE)
sp.to.keep <- names(which(table(data0$species) >= 5))
data <- data0[data0$species %in% sp.to.keep, ]
data$species <- droplevels(data$species)
data$SVL <- log(data$SVL)
shape <- as.matrix(log(data[, 8:ncol(data)]))
rdf <- rrpp.data.frame(svl = data$SVL, shape = shape, habitat = data$habitat_broad, species = data$species)
tree0 <- read.nexus('data/phylogeny/pristurus_tree_final.nex')
LS.mns <- pairwise(lm.rrpp(shape~species, data = rdf, iter=0), groups = rdf$species)$LS.means[[1]]
sz.mn <- tapply(rdf$svl,rdf$species,mean)
hab.mn <- as.factor(by(rdf$habitat,rdf$species,unique))
levels(hab.mn) <- levels(rdf$habitat)
tree <- treedata(phy = tree0, data = LS.mns)$phy
C <- vcv.phylo(tree)
# 1: Evolutionary Allometry
allom.sp <- lm.rrpp(LS.mns~sz.mn, Cov = C)
allom.ind <- lm.rrpp(shape~svl, data = rdf)
anova(allom.sp)
anova(allom.ind)
M <-rbind(coef.evol <- allom.sp$LM$gls.coefficients[2,],
coef.ind <- allom.ind$LM$coefficients[2,])
acos(RRPP:::vec.cor.matrix(M))*180/pi  #virtually parallel (angle of 1.49 degrees)
# 2: Comparison of evolutionary allometry with individual (habitat-based) allometry
fit.hab <- lm.rrpp(shape~svl*habitat, data = rdf)
anova(fit.hab)
fit.0 <- lm.rrpp(shape~habitat, data = rdf) #H_0: group differences only (no allometry)
pw.hab <- pairwise(fit.hab, fit.null = fit.0, groups = rdf$habitat, covariate = rdf$svl)
slp.hab <- pw.hab$slopes[[1]]
#Slopes by habitat
slopes <- lapply(1:1000, function(j) rbind(coef.evol,pw.hab$slopes[[j]]))
slp.ang <- lapply(1:1000, function(j) acos(RRPP:::vec.cor.matrix(slopes[[j]]))*180/pi)
slp.hab.obs <- slp.ang[[1]]
slp.Z <- RRPP:::effect.list(slp.ang)
slp.P <- RRPP:::Pval.list(slp.ang)
slp.hab.obs
slp.Z
slp.hab.obs <- slp.ang[[1]]
slp.Z <- RRPP:::effect.list(slp.ang)
slp.P <- RRPP:::Pval.list(slp.ang)
rownames(slp.hab.obs) <- colnames(slp.hab.obs) <-
rownames(slp.Z) <- colnames(slp.Z) <-
rownames(slp.P) <- colnames(slp.P) <-
c("Evolutionary", "Ground", "Rock", "Tree")
slp.hab.obs
slp.Z
slp.P  #angles significantly smaller than expected
(m2 <- matrix(1:20, 4, 5))
lower.tri(m2)
m2[lower.tri(m2)] <- NA
m2
(m2 <- matrix(1:20, 4, 5))
lower.tri(m2)
m2[lower.tri(m2)] <- ""
m2
(m2 <- matrix(1:20, 4, 5))
lower.tri(m2)
m2[lower.tri(m2)] <-
m2
(m2 <- matrix(1:20, 4, 5))
lower.tri(m2)
m2[lower.tri(m2)] <- NULL
(m2 <- matrix(1:20, 4, 5))
lower.tri(m2)
m2[lower.tri(m2)] <- NA
m2
slp.Z[lower.tri(slp.Z)]
library(knitr)
library(kableExtra)
library(tidyverse)
library(geomorph)
library(phytools)
library(geiger)
library(RRPP)
knitr::opts_chunk$set(echo = TRUE)
rownames(slp.hab.obs) <- colnames(slp.hab.obs) <-
rownames(slp.Z) <- colnames(slp.Z) <-
rownames(slp.P) <- colnames(slp.P) <-
c("Evolutionary", "Ground", "Rock", "Tree")
lower.tri(slp.Z)
lower.tri(slp.Z, diag=T)
slp.Z[lower.tri(slp.Z, diag=T)]
lower.triangle(slp.Z)
slp.Z[upper.tri(slp.Z)] <- -
rownames(slp.hab.obs) <- colnames(slp.hab.obs) <-
rownames(slp.Z) <- colnames(slp.Z) <-
rownames(slp.P) <- colnames(slp.P) <-
c("Evolutionary", "Ground", "Rock", "Tree")
slp.Z[upper.tri(slp.Z)] <- '-'
slp.Z
slp.Z <- RRPP:::effect.list(slp.ang)
slp.P <- RRPP:::Pval.list(slp.ang)
slp.hab.obs
slp.ZP <-slp.Z
slp.ZP[upper.tri(slp.ZP)] <- upper.tri(slp.P)
slp.ZP
slp.P
slp.hab.obs
slp.Z
slp.P  #angles significantly smaller than expected
tbl <- matrix(data = NULL, nrow = 14, ncol = 4)
tbl <- matrix(data = NA, nrow = 14, ncol = 4)
tbl
tbl <- rbind(slp.hab.obs,rep(0,4),slp.Z,rep(0,4),slp.P)
tbl
tbl2 <- rbind(slp.hab.obs,slp.Z,slp.P)
dim(tbl2)
slp.P
slp.P-1
1-slp.P
t <-1-slp.P
diag(t) <- 1
t
slp.Z[upper.tri(slp.Z)]<- "."
slp.Z
as.numeric(slp.Z)
slp.Z[upper.tri(slp.Z)]<- ""
slp.Z
library(knitr)
library(kableExtra)
library(tidyverse)
library(geomorph)
library(phytools)
library(geiger)
library(RRPP)
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
slp.hab.obs <- slp.ang[[1]]
slp.hab.obs
slp.Z
slp.hab.obs <- slp.ang[[1]]
slp.Z <- RRPP:::effect.list(slp.ang)
slp.P <- RRPP:::Pval.list(slp.ang)
slp.Z
digits(slp.Z)
?digits
t <- digits(slp.P,3)
digits(slp.P) <- 3
?round
round(slp.P, digits = 3)
summary(pw.hab)
summary(pw.hab, type = 'VC', stat.table = FALSE)
pw.hab <- pairwise(fit.hab, groups = rdf$habitat, covariate = rdf$svl)
summary(pw.hab, type = 'VC', stat.table = FALSE)
# 2: MANCOVA & comparison of allometry among habitats
fit.hab <- lm.rrpp(shape~svl*habitat, data = rdf)
anova(fit.hab)
pw.hab1 <- pairwise(fit.hab, groups = rdf$habitat, covariate = rdf$svl)
summary(pw.hab1, type = 'VC', stat.table = FALSE)
# 2A: Compare evolutionary and static (habitat) allometry
fit.0 <- lm.rrpp(shape~habitat, data = rdf) #H_0: group differences only (no allometry)
pw.hab <- pairwise(fit.hab, fit.null = fit.0, groups = rdf$habitat, covariate = rdf$svl)
summary(pw.hab, type = 'VC', stat.table = FALSE)
slp.hab <- pw.hab$slopes[[1]]
#Slopes by habitat
slopes <- lapply(1:1000, function(j) rbind(coef.evol,pw.hab$slopes[[j]]))
slp.ang <- lapply(1:1000, function(j) acos(RRPP:::vec.cor.matrix(slopes[[j]]))*180/pi)
slp.hab.obs <- slp.ang[[1]]
slp.Z <- RRPP:::effect.list(slp.ang)
slp.P <- RRPP:::Pval.list(slp.ang)
slp.hab.obs
slp.Z
slp.P  #angles significantly smaller than expected
libs <- c('geomorph', 'RRPP', 'phytools', 'geiger', 'tidyverse')
easypackages::libraries(libs)
# 0: Data Prep
data0 <- read.table('data/morpho/morpho_pristurus.csv', sep = ';', dec = '.', header = TRUE, stringsAsFactors = TRUE)
sp.to.keep <- names(which(table(data0$species) >= 5))
data <- data0[data0$species %in% sp.to.keep, ]
data$species <- droplevels(data$species)
data$SVL <- log(data$SVL)
shape <- as.matrix(log(data[, 8:ncol(data)]))
rdf <- rrpp.data.frame(svl = data$SVL, shape = shape, habitat = data$habitat_broad, species = data$species)
tree0 <- read.nexus('data/phylogeny/pristurus_tree_final.nex')
LS.mns <- pairwise(lm.rrpp(shape~species, data = rdf, iter=0), groups = rdf$species)$LS.means[[1]]
sz.mn <- tapply(rdf$svl,rdf$species,mean)
hab.mn <- as.factor(by(rdf$habitat,rdf$species,unique))
levels(hab.mn) <- levels(rdf$habitat)
tree <- treedata(phy = tree0, data = LS.mns)$phy
C <- vcv.phylo(tree)
# 1: Evolutionary Allometry
allom.sp <- lm.rrpp(LS.mns~sz.mn, Cov = C)
allom.ind <- lm.rrpp(shape~svl, data = rdf)
anova(allom.sp)
anova(allom.ind)
M <-rbind(coef.evol <- allom.sp$LM$gls.coefficients[2,],
coef.ind <- allom.ind$LM$coefficients[2,])
acos(RRPP:::vec.cor.matrix(M))*180/pi  #virtually parallel (angle of 1.49 degrees)
# 2: MANCOVA & comparison of allometry among habitats
fit.hab <- lm.rrpp(shape~svl*habitat, data = rdf)
anova(fit.hab)
pw.hab1 <- pairwise(fit.hab, groups = rdf$habitat, covariate = rdf$svl)
summary(pw.hab1, type = 'VC', stat.table = FALSE)
# 2A: Compare evolutionary and static (habitat) allometry
fit.0 <- lm.rrpp(shape~habitat, data = rdf) #H_0: group differences only (no allometry)
pw.hab <- pairwise(fit.hab, fit.null = fit.0, groups = rdf$habitat, covariate = rdf$svl)
summary(pw.hab, type = 'VC', stat.table = FALSE)
slp.hab <- pw.hab$slopes[[1]]
#Slopes by habitat
slopes <- lapply(1:1000, function(j) rbind(coef.evol,pw.hab$slopes[[j]]))
slp.ang <- lapply(1:1000, function(j) acos(RRPP:::vec.cor.matrix(slopes[[j]]))*180/pi)
slp.hab.obs <- slp.ang[[1]]
slp.Z <- RRPP:::effect.list(slp.ang)
slp.P <- RRPP:::Pval.list(slp.ang)
slp.hab.obs
slp.Z
slp.P  #angles significantly smaller than expected
res <- cbind(slp.hab.obs[,1],slp.Z[,1],slp.P[,1])
colnames(res) <- c("Angle","Effect Size", "P-value")
rownames(res) <- c("Evolutionary", "Ground", "Rock", "Tree")
res
res <- cbind(slp.hab.obs[-1,1],slp.Z[-1,1],slp.P[-1,1])
colnames(res) <- c("Angle","Effect Size", "P-value")
rownames(res) <- c("Ground", "Rock", "Tree")
res
libs <- c('geomorph', 'RRPP', 'phytools', 'geiger', 'tidyverse')
easypackages::libraries(libs)
# 0: Data Prep
data0 <- read.table('data/morpho/morpho_pristurus.csv', sep = ';', dec = '.', header = TRUE, stringsAsFactors = TRUE)
easypackages::libraries(libs)
# 0: Data Prep
data0 <- read.table('data/morpho/morpho_pristurus.csv', sep = ';', dec = '.', header = TRUE, stringsAsFactors = TRUE)
sp.to.keep <- names(which(table(data0$species) >= 5))
data <- data0[data0$species %in% sp.to.keep, ]
data$species <- droplevels(data$species)
data$SVL <- log(data$SVL)
shape <- as.matrix(log(data[, 8:ncol(data)]))
rdf <- rrpp.data.frame(svl = data$SVL, shape = shape, habitat = data$habitat_broad, species = data$species)
tree0 <- read.nexus('data/phylogeny/pristurus_tree_final.nex')
LS.mns <- pairwise(lm.rrpp(shape~species, data = rdf, iter=0), groups = rdf$species)$LS.means[[1]]
sz.mn <- tapply(rdf$svl,rdf$species,mean)
hab.mn <- as.factor(by(rdf$habitat,rdf$species,unique))
levels(hab.mn) <- levels(rdf$habitat)
tree <- treedata(phy = tree0, data = LS.mns)$phy
C <- vcv.phylo(tree)
# 1: Evolutionary Allometry
allom.sp <- lm.rrpp(LS.mns~sz.mn, Cov = C)
allom.ind <- lm.rrpp(shape~svl, data = rdf)
anova(allom.sp)
anova(allom.ind)
M <-rbind(coef.evol <- allom.sp$LM$gls.coefficients[2,],
coef.ind <- allom.ind$LM$coefficients[2,])
acos(RRPP:::vec.cor.matrix(M))*180/pi  #virtually parallel (angle of 1.49 degrees)
# 2: MANCOVA & comparison of allometry among habitats
fit.hab <- lm.rrpp(shape~svl*habitat, data = rdf)
anova(fit.hab)
pw.hab1 <- pairwise(fit.hab, groups = rdf$habitat, covariate = rdf$svl)
summary(pw.hab1, type = 'VC', stat.table = FALSE)
sz.mn <- tapply(rdf$svl,rdf$species,mean)
# 2A: Compare evolutionary and static (habitat) allometry
fit.0 <- lm.rrpp(shape~habitat, data = rdf) #H_0: group differences only (no allometry)
pw.hab <- pairwise(fit.hab, fit.null = fit.0, groups = rdf$habitat, covariate = rdf$svl)
summary(pw.hab, type = 'VC', stat.table = FALSE)
slp.hab <- pw.hab$slopes[[1]]
summary(pw.hab1, type = 'VC', stat.table = FALSE)
# 2A: Compare evolutionary and static (habitat) allometry
fit.0 <- lm.rrpp(shape~habitat, data = rdf) #H_0: group differences only (no allometry)
pw.hab <- pairwise(fit.hab, fit.null = fit.0, groups = rdf$habitat, covariate = rdf$svl)
summary(pw.hab, type = 'VC', stat.table = FALSE)
slp.hab <- pw.hab$slopes[[1]]
#Slopes by habitat
slopes <- lapply(1:1000, function(j) rbind(coef.evol,pw.hab$slopes[[j]]))
slp.ang <- lapply(1:1000, function(j) acos(RRPP:::vec.cor.matrix(slopes[[j]]))*180/pi)
slp.hab.obs <- slp.ang[[1]]
slp.Z <- RRPP:::effect.list(slp.ang)
slp.P <- RRPP:::Pval.list(slp.ang)
slp.hab.obs
slp.Z
slp.P  #angles significantly smaller than expected
res <- cbind(slp.hab.obs[-1,1],slp.Z[-1,1],slp.P[-1,1])
colnames(res) <- c("Angle","Effect Size", "P-value")
rownames(res) <- c("Ground", "Rock", "Tree")
res
slp.P <-1-slp.P
diag(slp.P) <- 1
slp.P  #angles significantly smaller than expected
slp.hab.obs
slp.Z
slp.P  #angles significantly smaller than expected
res <- cbind(slp.hab.obs[-1,1],slp.Z[-1,1],slp.P[-1,1])
colnames(res) <- c("Angle","Effect Size", "P-value")
rownames(res) <- c("Ground", "Rock", "Tree")
res
# 3: Map allometry slopes on phylogeny
head.scores <- two.b.pls(shape[, c(2:4)], rdf$svl)$XScores[, 1]
limb.scores <- two.b.pls(shape[, 5:8], rdf$svl)$XScores[, 1]
# 4: phylomorphospace of size-standardized data (residuals)
shape.res <- residuals(allom.sp)
pca.w.phylo <- gm.prcomp(shape.res, phy = tree)
plot(pca.w.phylo, phylo = TRUE, pch = 21, bg = 'black', phylo.par = list(node.labels = FALSE))
# 5: Compare Integration
lindims.gp <- lapply( split( shape[,1:ncol(shape)], rdf$habitat), matrix, ncol=ncol(shape))
Vrel.gp <- Map(function(x) integration.Vrel(x), lindims.gp)
c(Vrel.gp$ground$ZR,Vrel.gp$rock$ZR,Vrel.gp$tree$ZR)
out <- compare.ZVrel(Vrel.gp$ground, Vrel.gp$rock, Vrel.gp$tree)
summary(out)
shape.res
fit.lm <- lm.rrpp(shape.res~hab.mn, Cov =C)
PW.lm <- pairwise(fit.lm,groups = hab.mn)
summary(PW.lm, test.type = "var")
fit.lm <- lm.rrpp(shape.res~hab.mn)
library(knitr)
library(kableExtra)
library(RRPP)
library(geomorph)
library(tidyverse)
library(geiger)
knitr::opts_chunk$set(echo = TRUE)
PW.lm <- pairwise(fit.lm,groups = hab.mn)
summary(PW.lm, test.type = "var")
fit.lm <- lm.rrpp(LS.mns~hab.mn, Cov =C)
PW.lm <- pairwise(fit.lm,groups = hab.mn)
summary(PW.lm, test.type = "var")
