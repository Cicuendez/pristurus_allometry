# 0: Data Prep
data0 <- read.table('data/morpho/morpho_pristurus.csv', sep = ';', dec = '.', header = TRUE, stringsAsFactors = TRUE)
sp.to.keep <- names(which(table(data0$species) >= 5))
data <- data0[data0$species %in% sp.to.keep, ]
data$species <- droplevels(data$species)
data$SVL <- log(data$SVL)
shape <- as.matrix(log(data[, 8:ncol(data)]))
rdf <- rrpp.data.frame(svl = data$SVL, shape = shape, habitat = data$habitat_broad, species = data$species)
######################## NEW STUFF IS IN HERE
# 2: Comparison of multivariate allometry among habitat types
fit.hab <- lm.rrpp(shape~svl*habitat, data = rdf)
anova(fit.hab)
pw.hab <- pairwise(fit.hab, groups = rdf$habitat, covariate = rdf$svl)
summary(pw.hab, type = 'VC', stat.table = FALSE)
#Slopes by habitat
fit.coef <- fit.hab$LM$coefficients
fit.coef
######################## NEW STUFF IS IN HERE
lm.rrpp(shape~svl,data = rdf)$coefficients
######################## NEW STUFF IS IN HERE
lm.rrpp(shape~svl,data = rdf)$LM$coefficients
mn.sz <- mean(rdf$svl)
mn.sz
mn.shape <- tapply(rdf$shape,2,mean)
rdf$shape
mn.shape <- apply(rdf$shape,2,mean)
mn.shape
slopes <- rep(1,ncol(rdf$shape))
slopes
intercepts <- mn.shape slopes* mn.sz
intercepts <- mn.shape - (slopes * mn.sz)
intercepts
coef.orig
lm.rrpp(shape~svl,data = rdf)$LM$coefficients
rdfFsvl
rdf$svl
preds <-
X <- cbind(1,rdf$svl)
X
b <- rbind(intercepts,slopes)
b
X%*%b
preds <- crossprod(X,b)
preds <- tcrossprod(X,b)
preds <- crossprod(X,b)
X%*%b
dim(X%*%b)
crossprod(b,X)
tcrossprod(b,X)
preds <- X%*%b
iso.line <- prcomp(preds)$x[,1]
dim(iso.line)
length(iso.line)
plot(rdf$svl,iso.line)
plot(fit.hab,type = "regression")
plot(fit.hab,type = "regression", predictor = rdf$svl)
lines(rdf$svl,iso.line, col = "red")
